
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shop - Neelkanth Trades</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f5f5f5;
}

/* HEADER */
.header-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    background: #0f8a52;
    color: white;
}
.cart-icon {
    background: white;
    color: #0f8a52;
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}

h2, h3 { margin-left: 20px; }

.product-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
    padding: 20px;
}

.product-card {
    background: white;
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    text-align: center;
}
.product-card img {
    width: 130px;
    height: 130px;
    object-fit: contain;
}

.qty-btn {
    padding: 4px 10px;
    background: #0f8a52;
    color: white;
    border: none;
    border-radius: 4px;
}
.qty-number { padding: 4px 10px; }

.add-btn {
    margin-top: 8px;
    padding: 8px 12px;
    background: #0f8a52;
    color: white;
    border-radius: 6px;
    border: none;
}

/* ===== SEARCH ===== */
.shop-search-container {
    position: sticky;
    top: 0;
    background: #f5f5f5;
    padding: 12px 20px;
    z-index: 1000;
}

.search-wrapper {
    display: flex;
    gap: 8px;
}

#shopSearchInput {
    flex: 1;
    padding: 12px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

.search-btn {
    background: #0f8a52;
    border: none;
    color: white;
    padding: 12px 14px;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
}

.search-suggestions {
    background: white;
    margin-top: 6px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,.15);
    display: none;
    max-height: 220px;
    overflow-y: auto;
}

.search-suggestions div {
    padding: 10px;
    cursor: pointer;
}

.search-suggestions div.active,
.search-suggestions div:hover {
    background: #e6f4ec;
}

/* highlight */
mark {
    background: #c8f7dc;
    padding: 0 3px;
}

footer {
    background: #0d6e44;
    color: white;
    text-align: center;
    padding: 15px;
    margin-top: 40px;
}
</style>

<script src="js/main.js" defer></script>
<script src="js/products.js" defer></script>
</head>

<body>

<div class="header-bar">
    <h3 style="margin:0;">Neelkanth Trades</h3>
    <div onclick="location.href='cart.html'" class="cart-icon">
        üõí <span id="cartCount">0</span>
    </div>
</div>

<!-- SEARCH -->
<div class="shop-search-container">
    <div class="search-wrapper">
        <input id="shopSearchInput" placeholder="Search products (name / unit)">
        <button class="search-btn">üîç</button>
    </div>
    <div id="searchSuggestions" class="search-suggestions"></div>
</div>

<h2>Shop Products</h2>

<h3>Grocery</h3>
<div class="product-grid" id="groceryProducts"></div>

<h3>Cosmetics</h3>
<div class="product-grid" id="cosmeticsProducts"></div>

<h3>Hygiene</h3>
<div class="product-grid" id="hygieneProducts"></div>

<footer>
Neelkanth Trades | #394 Sector 3 Industrial Area Karnal | 9416110032
</footer>

<script>
let activeIndex = -1;

function handleSearch(query) {
    filterProductsBySearch(query);

    if (query.trim() === "") {
        highlight("");
        hideSuggestions();
        return;
    }

    highlight(query);
    showSuggestions(query);
}

document.getElementById("shopSearchInput").addEventListener("keydown", e => {
    const items = document.querySelectorAll("#searchSuggestions div");

    if (e.key === "ArrowDown") activeIndex = Math.min(activeIndex + 1, items.length - 1);
    if (e.key === "ArrowUp") activeIndex = Math.max(activeIndex - 1, 0);

    if (e.key === "Enter") {
        if (activeIndex >= 0 && items[activeIndex]) {
            selectSuggestion(items[activeIndex].innerText);
        } else {
            handleSearch(e.target.value);
            scrollToFirst();
        }
        hideSuggestions();
    }

    items.forEach((el,i)=>el.classList.toggle("active", i===activeIndex));
});

document.querySelector(".search-btn").onclick = () => {
    handleSearch(shopSearchInput.value);
    scrollToFirst();
};

function showSuggestions(query) {
    const box = document.getElementById("searchSuggestions");
    box.innerHTML = "";
    activeIndex = -1;

    if (!query) { box.style.display="none"; return; }

    document.querySelectorAll(".product-card h4").forEach(h=>{
        if (h.innerText.toLowerCase().includes(query.toLowerCase())) {
            const div = document.createElement("div");
            div.innerText = h.innerText;
            div.onclick = ()=>selectSuggestion(h.innerText);
            box.appendChild(div);
        }
    });

    box.style.display = box.children.length ? "block" : "none";
}

function selectSuggestion(text) {
    shopSearchInput.value = text;
    handleSearch(text);
    scrollToFirst();
    hideSuggestions();
}

function hideSuggestions() {
    document.getElementById("searchSuggestions").style.display="none";
}

function scrollToFirst() {
    const card = document.querySelector(".product-card[style*='block']");
    if (card) card.scrollIntoView({behavior:"smooth", block:"center"});
}

function highlight(query) {
    document.querySelectorAll(".product-card h4").forEach(h=>{
        const t = h.innerText;
        h.innerHTML = query ? t.replace(new RegExp(query,"gi"), m=>`<mark>${m}</mark>`) : t;
    });
}

/* ===== LIVE SEARCH WHILE TYPING ===== */
document.getElementById("shopSearchInput").addEventListener("input", e => {
    handleSearch(e.target.value);
});

/* ===== CLICK OUTSIDE TO CLOSE SUGGESTIONS ===== */
document.addEventListener("click", e => {
    const container = document.querySelector(".shop-search-container");
    if (!container.contains(e.target)) {
        hideSuggestions();
        activeIndex = -1;
    }
});
</script>

<script>
/* ===== APPLY SEARCH FROM HOME PAGE REDIRECT ===== */
document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const search = params.get("search");

    if (!search) return;

    const input = document.getElementById("shopSearchInput");
    if (!input) return;

    // Put text back into search box
    input.value = search;

    // Run full search pipeline
    if (typeof handleSearch === "function") {
        handleSearch(search);
    } else if (typeof filterProductsBySearch === "function") {
        filterProductsBySearch(search);
    }

    // Scroll to first visible product
    setTimeout(() => {
        const card = document.querySelector(".product-card[style*='block'], .product-card:not([style])");
        if (card) {
            card.scrollIntoView({ behavior: "smooth", block: "center" });
        }
    }, 200);
});
</script>

<!-- Floating Cart Button -->
<a href="cart.html" class="floating-cart">
  üõí <span id="cartCount">0</span>
</a>

<!-- Floating WhatsApp Button -->
<a href="https://wa.me/919416110032" class="floating-whatsapp" target="_blank">
  üí¨
</a>

</body>
</html>
